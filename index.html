<!-- source is https://bl.ocks.org/mbostock/4060366 -->
<!DOCTYPE html>
<htm>
<meta charset="utf-8">
<style>

.map {
  stroke: #0000;
  stroke-opacity: 0.2;
}


</style>
<body>
<div style="width:2000px">
    <svg width="800" height="800" id="map" ></svg>
    <svg width="800" height="600" id="bar" ></svg>
    <!-- <svg id="reference" width="960" height="800"></svg> -->
</div>

<!-- Checkboxes -->
<div class="filter_options">
    <input class="color_button" name="GenderBreakdown" value="GenderBreakdown" type="checkbox">GenderBreakdown</input>
    <input class="color_button" name="AgeBreakdown" value="AgeBreakdown" type="checkbox">AgeBreakdown</input>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>


var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

d3.json("streets.json", function (data) {

        var connect = d3.line()
            .x(function (d) { return d.x * 40; })
            .y(function (d) { return d.y * 40; })
            .curve(d3.curveBasis);

        for (var i = 0; i < data.length; i++){
            var line = data[i];
            d3.select('svg').append('path')
                .style('fill', 'none')
                .style('stroke', '#414141')
                .style('stroke-width', '2px')
                .attr('d', connect(line))

        }
    });

d3.csv("pumps.csv", function (pumps) {

    d3.select('#map').selectAll('image')
        .data(pumps)
        .enter().append("image")
        .attr("xlink:href", "pump.png")
        .attr("x", function(d){ return d.x  * 40})
        .attr("y", function(d){ return d.y  * 39})
        .attr("width", "32px")
        .attr("height", "32px")

});

d3.csv("deaths_age_sex1.csv", function (data) {
    var sexcolor = d3.scaleOrdinal()
        .domain([0, 1])
        .range(["#3E09B9", "#BD0756"])

    var agecolor = d3.scaleOrdinal()
        .domain([0, 1, 2, 3, 4, 5])
        .range(["purple", "indigo", "violet", 'pink', 'orange', 'grey'])

    // var gendercheckbox = document.getElementById("gender");  
    // var agecheckbox = document.getElementById("age"); 

    d3.select('#map').selectAll('circle')
            .data(data)
            .enter().append('circle')
            // .style('fill', function(d){
            //     //get the value of the checked
            //     var value = d3.select('input[id="dataset"]').node().value;
            //     if (value == "GenderBreakdown") {
            //         return sexcolor(d.gender);
            //     } else if (value == "AgeBreakdown") {
            //         return agecolor(d.age); 
            //     } else {
            //         return 'blue'
            //     }
            // })
            .style('fill', 'blue')
            .attr('r', '3px')
            .attr('cx', function(d) { return d.x * 40; })
            .attr('cy', function(d) { return d.y * 40; })
            .attr('dateid', function(d) { return 'left_' + d.dateid; } )
            .attr('age', function(d) { return d.age; } );

    // d3.select('#map').selectAll('circle')
    //         .data(data)
    //         .enter()
    //         // .append('label')
    //         //     .attr('for', function(d,i){ return 'a'+i; })
    //         //     .text(function(d) { return d; })
    //         .append("input")
    //             .attr("checked", true)
    //             .attr("type", "checkbox")
    //             .attr("id", function(d,i) { return 'a'+i; })
    //             .attr("onClick", "change(this)");

    // a function that will be responsible for updating the visibility of the dots
    // function update() {

        

    //     // a helper function that will return the correct display value
    //     // it will be called for every dot
        // function display(d) {

        //     if (gendercheckbox.checked == true){  
        //         d3.selectAll('circle')
        //         .style('fill', function (d) { return sexcolor(d.gender) })
        //         }
        //     else if (agecheckbox.checked == true){  
        //         d3.selectAll('circle')
        //         .style('fill', function (d) { return agecolor(d.age) })
        //         }
        //     else {
        //         d3.selectAll('circle')
        //         .style('fill', 'blue')
        //     }

    //     // we change the display attribute of every dot using the display function just defined
    //     d3.selectAll('circle').attr('display', display);
    //     }

    // we add a simple handler to all the checkboxes: every time one changes,
    // just call update
    // d3.selectAll(".filter_options input").on("change", update);

    //Change deaths color by age
    d3.selectAll("input[name='AgeBreakdown']").on("click", function() {
        var value = d3.select(this).property("checked")
        if (value == true) {
            d3.selectAll('circle')
                .style('fill', function (d) { return agecolor(d.age) })
        } else {
            d3.selectAll('circle')
                .style('fill', 'blue')
        }
    })

    //Change deaths color by gender
    d3.selectAll("input[name='GenderBreakdown']").on("click", function() {
        var value = d3.select(this).property("checked")
        if (value == true) {
            d3.selectAll('circle')
                .style('fill', function (d) { return sexcolor(d.gender) })
        } else {
            d3.selectAll('circle')
                .style('fill', 'blue')
        }
    })

});

var svg = d3.select("#bar"),
            margin = 300,
            width = svg.attr("width") - margin,
            height = svg.attr("height") - margin


var xScale = d3.scaleBand().range([0, width]).padding(0.4);
var yScale = d3.scaleLinear().range([height, 0]);

var g = svg.append("g")
            .attr("transform", "translate(" + 100 + "," + 100 + ")");

d3.csv("deathdays1.csv", function(error, data) {
        if (error) {
            throw error;
        }

        xScale.domain(data.map(function(d) { return d.date; }));
        yScale.domain([0, d3.max(data, function(d) { return d.deaths*1.2; })]);

        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale))
         .selectAll("text")
         .attr("dx", "-2.4em")
         .attr("dy", ".15em")
         .attr("transform", "rotate(-65)");

        g.append("g")
         .call(d3.axisLeft(yScale)
         .ticks(10)
         );

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return xScale(d.date); })
         .attr("y", function(d) { return yScale(d.deaths); })
         .attr("width", xScale.bandwidth())
         .attr("height", function(d) { return height - yScale(d.deaths); })
         .attr('dateid', function(d) { return "right_" + d.dateid; } )

        //  .on("mouseover", function(d) { d3.select(this)
        //     .attr("fill", "orange")
        //  })
        //  .on("mouseout", function(d) {d3.select(this)
        //     .attr("fill", "rgb(0, 0, " + (d * 10) + ")");
        //  });
        
        // .on("mouseout", (d, i, p) => {
        //     d3.select(p[i]).attr("fill", "black")

        .on("mouseover", function(d) {
            var selecteddate = d.dateid;

            d3.select(this).attr("fill", "maroon");

            d3
            .selectAll('circle')
            .filter(function(d) {
              return (d.dateid) == selecteddate
            })
            .style("fill", "maroon");
        })
        .on("mouseout", function(d)  {
            var selecteddate = d.dateid;

            d3.select(this).attr("fill", "black")

            d3
            .selectAll('circle')
            .filter(function(d) {
              return (d.dateid) == selecteddate
            })
            .style("fill", "blue");
        })
        ;
        
        // Labelling the bars
        g.append('g')
        .selectAll("text")
        .data(data)                                 
        .enter().append("text")
        .text(function(d) { 
            return d.deaths;
        })
        .attr("x", function(d) { return xScale(d.date)*1.02; })
        .attr("y", function(d) { return yScale(d.deaths); })
        .attr("font-family" , "sans-serif")
        .attr("font-size" , "14px")
        .attr("fill" , "black")
        .attr("text-anchor", "middle");

    });

</script>
</body>
</html>